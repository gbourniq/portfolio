# Introduction
Generate `docx` files with Eigen Branding from templates.

## Overview
Documents are generated by using templates in markdown (`.md`) format. It can contain the whole document written in markdown which is eventually converted into MS Word (`.docx`) format with standard Eigen styling and branding. Alternatively, it is possible to define some 'configurable' content that gets populated when Word file is generated.

For example, a document could have a 'start date' written somewhere, but the actual date could be different depending on some factors. Rather than hardcoding the date in markdown template and changing it later, we can put a placeholder tag such as `{{ start_date }}` instead. When converting markdown into Word format, document generator will find the placeholder tags and put the date from other source. This is stored in the `.yml` file and must have the definitions of all tags (such as `start_date`) and their values. Both markdown and yaml files are referred to as templates since they both might be required to produce a Word document.


## Architecture
The tool creates Word documents in a few stages.
1. Given input arguments, it finds relevant markdown and yaml templates,
2. It takes the content defined in yaml template and injects it to markdown using Jinja2 framework. This creates a new, temporary markdown file with full content that is intended to be on the document.
3. Temporary markdown file with full content is converted into the final docx. Pandoc package is used to to carry out the conversion and apply Eigen branding to docx based on the template in `templates/word/eigen_branding.docx`.
4. Temporary markdown file is removed.

# Usage
## Running doc-generator
To run doc-generator, it needs at least input 2 arguments:
 - `--path` represents the directory containing markdown and yaml templates.
 - `--template-name` represents the name of the markdown and yaml templates.

The other two arguments are not mandatory:
 - `--output-directory` indicates where the output docx document should be placed. If this is not specified, it will generate the output within doc-generator directory. Output filename should not be specified. It will be the same as `--template-name`.
 - Given that pandoc package can take a wide range of arguments by itself, `--pandoc-args` provides a way to pass arguments specifically to it. Any space-delimited arguments specified after `--pandoc-args` will be passed into pandoc. Note that any arguments already defined against doc-generator could not be passed into pandoc. For example, you cannot do `--pandoc-args --path`, because `--path` is already specified for doc-generator.

## Requirements
In order to convert templates to Word documents, a number of requirements must be met.
 - Path specified through `--path` must exist. It raises error otherwise.
 - Both markdown templates must exist in directory specified through `--path`.
 - Both markdown and yaml templates must have the name specified through `--template-name`
   For example: if `template-name` is passed as 'doc', then
   `doc.md` and `doc.yml` files must be present in `--path`.
 - If no text injection is required for markdown template,
   yml file must still be present (even if it is blank).
 - While there are numerous file extensions that represent
   markdown and yml files, only .md and .yml are supported.

## Other notes
 - If the given output directory does not exist, it will
   create it automatically.
 - If output directory already has file with the same name as
   output file, it will ask user if it should be overwritten.


# Templates
Yaml files contain tag definitions and their appropriate values. For example, if `fancy_template.yml` contains
```
start_date: 24 Apr 2019
```
any `{{ start_date }}` tags in the markdown will be replaced with 24 Apr 2019 when converted into Word format.
Yaml file format also supports lists and nested items such as
```
project:
  name: very important project
  description: It's important, but should be cheap

  start:
    date: 01/01/01
    cost: Â£1

  delivery_team:
    - Bob
    - Alice
    - John Wick
```
Using information in the yaml template, project name can be inserted via `{{ project.name }}` tag, project start date by `{{ project.start.date }}` and the list of names in the delivery team via `{{ project.delivery_team }}`.

## Text injection
When Word documents are generated, text is injected into markdown templates using Jinja2 framework in the background. This means that a variety of other tools supported by Jinja2 can be used in markdown templates as well. Some of these are tags you have seen already, conditional statements where text is shown if some condition is true, loops, etc. More information about Jinja2 and its capabilities can be found online. Some of the main Jinja2 functions are shown below.

### Simple tags
This has already been covered before, where tags are defined in curly brackets via
```
{{ some_tag }}
```

### Conditionals
They are represented by
```
{% some_condition %}
Display this
{% endif %}
```
where `some_condition` is just another variable injected into markdown using normal methods. The final document will contain `Display this` text if `some_condition` is true.

### Loops
Loops are defined as follows:
```
{% for row in table -%}
{{ row }}
{% endfor %}
```
where table is an iterable in Python. You can also do something like
```
{% for item in questions_info -%}
{{ item.counter }}, {{ item.question }}, {{ item.answer }}
{% endfor %}
```
if each element in the `question_info` has `counter`, `question` and `answer` attributes.

### Tables
Consider the following yaml file:
```
table:
  rows:
    - id: 1
      name: a
    - id: 2
      name: b
    - id: 3
      name: c
```

A table in Word document can be generated using the table formatting in the markdown:
```
{% if table %}
| id | name |
|----|------|
{%tr for row in table.rows %}
| {{ row.id }} | {{ row.name }} |
{%tr endfor %}
{% endif %}
```

It would produce a table that looks like
```
| id | name |
|----|------|
| 1 | a |
| 2 | b |
| 3 | c |
```